<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WPK俱乐部综合管理系统</title>
    <style>
        .real-time-games {
    margin-top: 30px;
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.real-time-game-active {
    background-color: #e8f5e9 !important;
}

.real-time-game-warning {
    background-color: #fff8e1 !important;
}

.pot-size {
    font-weight: bold;
    color: #e74c3c;
}

.current-player {
    font-weight: bold;
    color: #3498db;
}

.status-waiting {
    color: #f39c12;
    font-weight: bold;
}
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --gray-color: #95a5a6;
        }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        h1, h2, h3 {
            color: var(--dark-color);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-color);
        }
        .container {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }
        .tab-container {
            margin-bottom: 30px;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
            color: var(--primary-color);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 15px;
        }
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--dark-color);
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }
        .btn-success {
            background-color: var(--secondary-color);
            color: white;
        }
        .btn-success:hover {
            background-color: #27ae60;
        }
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        .btn-warning:hover {
            background-color: #d35400;
        }
        .btn-gray {
            background-color: var(--gray-color);
            color: white;
        }
        .btn-gray:hover {
            background-color: #7f8c8d;
        }
        .btn-sm {
            padding: 5px 10px;
            font-size: 14px;
        }
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .card-header {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .card-header h3 {
            margin-top: 0;
            color: var(--primary-color);
        }
        .card-body p {
            margin: 8px 0;
        }
        .card-footer {
            margin-top: 15px;
            text-align: right;
        }
        .table-container {
            margin-top: 30px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #e6f7ff;
        }
        .actions {
            display: flex;
            gap: 5px;
        }
        .summary {
            margin: 30px 0;
            padding: 20px;
            background-color: #eaf7fd;
            border-radius: 6px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .summary-card {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .summary-card h3 {
            margin-top: 0;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            font-size: 16px;
        }
        .chip {
            display: inline-block;
            padding: 3px 8px;
            background-color: #f1c40f;
            color: #34495e;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 5px;
        }
        .status-active {
            color: var(--secondary-color);
            font-weight: bold;
        }
        .status-ended {
            color: var(--gray-color);
            font-weight: bold;
        }
        .positive {
            color: var(--secondary-color);
            font-weight: bold;
        }
        .negative {
            color: var(--danger-color);
            font-weight: bold;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close-modal {
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>WPK俱乐部综合管理系统</h1>
        
        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('dashboard')">仪表盘</div>
                <div class="tab" onclick="switchTab('players')">玩家管理</div>
                <div class="tab" onclick="switchTab('games')">牌局管理</div>
                <div class="tab" onclick="switchTab('reports')">报表统计</div>
            </div>
            
            <!-- 仪表盘 -->
            <!-- 在仪表盘部分添加实时牌局显示 -->
<h2>实时牌局</h2>
<div class="real-time-games">
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>牌局ID</th>
                    <th>名称</th>
                    <th>游戏类型</th>
                    <th>盲注级别</th>
                    <th>当前玩家</th>
                    <th>底池</th>
                    <th>玩家数</th>
                    <th>状态</th>
                </tr>
            </thead>
            <tbody id="realTimeGamesTable">
                <!-- 实时牌局数据将在这里动态生成 -->
            </tbody>
        </table>
    </div>
</div>
            <div id="dashboard" class="tab-content active">
                <div class="summary">
                    <h2>系统概览</h2>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h3>活跃玩家</h3>
                            <p id="totalPlayers">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>活跃牌局</h3>
                            <p id="activeGames">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>今日牌局</h3>
                            <p id="todayGames">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>总充值</h3>
                            <p id="totalRecharge">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>总抽水</h3>
                            <p id="totalRake">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <h2>最近牌局</h2>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>牌局名称</th>
                                        <th>游戏类型</th>
                                        <th>盲注级别</th>
                                        <th>玩家</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="recentGamesTable">
                                    <!-- 最近牌局数据将在这里动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="form-group">
                        <h2>活跃玩家</h2>
                        <div id="activePlayersList" class="card-container">
                            <!-- 活跃玩家卡片将在这里动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 玩家管理 -->
            <div id="players" class="tab-content">
                <div class="form-section">
                    <h2>添加/编辑玩家</h2>
                    <form id="playerForm">
                        <input type="hidden" id="playerEditIndex" value="-1">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="playerId">ID：</label>
                                <input type="text" id="playerId" required>
                            </div>
                            <div class="form-group">
                                <label for="playerNickname">昵称：</label>
                                <input type="text" id="playerNickname" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="playerRecharge">充值：</label>
                                <input type="number" id="playerRecharge" min="0" value="0" required>
                            </div>
                            <div class="form-group">
                                <label for="playerFrozen">冻结积分：</label>
                                <input type="number" id="playerFrozen" min="0" value="0" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="playerLevel">玩家等级：</label>
                                <select id="playerLevel">
                                    <option value="普通">普通</option>
                                    <option value="VIP">VIP</option>
                                    <option value="VVIP">VVIP</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="playerStatus">状态：</label>
                                <select id="playerStatus">
                                    <option value="active">活跃</option>
                                    <option value="inactive">不活跃</option>
                                    <option value="banned">封禁</option>
                                </select>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" class="btn-success">保存玩家</button>
                            <button type="button" onclick="resetPlayerForm()" class="btn-gray">重置</button>
                        </div>
                    </form>
                </div>
                
                <h2>玩家列表</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>昵称</th>
                                <th>等级</th>
                                <th>充值</th>
                                <th>冻结积分</th>
                                <th>剩余积分</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="playersTable">
                            <!-- 玩家数据将在这里动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 牌局管理 -->
            <div id="games" class="tab-content">
                <div class="form-section">
                    <h2>创建/编辑牌局</h2>
                    <form id="gameForm">
                        <input type="hidden" id="gameEditId" value="">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gameName">牌局名称：</label>
                                <input type="text" id="gameName" required placeholder="例如：VIP1号桌">
                            </div>
                            <div class="form-group">
                                <label for="gameType">游戏类型：</label>
                                <select id="gameType" required>
                                    <option value="">请选择</option>
                                    <option value="德州扑克">德州扑克</option>
                                    <option value="奥马哈">奥马哈</option>
                                    <option value="短牌">短牌</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gameStakes">盲注级别：</label>
                                <input type="text" id="gameStakes" required placeholder="例如：10/20">
                            </div>
                            <div class="form-group">
                                <label for="gameBuyIn">买入金额：</label>
                                <input type="number" id="gameBuyIn" required placeholder="最小买入金额">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gameMaxPlayers">最大玩家数：</label>
                                <input type="number" id="gameMaxPlayers" min="2" max="10" value="6" required>
                            </div>
                            <div class="form-group">
                                <label for="gameTimeBank">思考时间(秒)：</label>
                                <input type="number" id="gameTimeBank" min="10" value="30" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gameAnte">前注：</label>
                                <input type="number" id="gameAnte" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label for="gameRake">抽水比例(%)：</label>
                                <input type="number" id="gameRake" min="0" max="10" step="0.1" value="5">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="gamePassword">牌局密码：</label>
                                <input type="password" id="gamePassword" placeholder="可选">
                            </div>
                            <div class="form-group">
                                <label for="gameStatus">牌局状态：</label>
                                <select id="gameStatus">
                                    <option value="active">进行中</option>
                                    <option value="waiting">等待中</option>
                                    <option value="ended">已结束</option>
                                </select>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button type="submit" class="btn-success">保存牌局</button>
                            <button type="button" onclick="resetGameForm()" class="btn-gray">重置</button>
                        </div>
                    </form>
                </div>
                
                <h2>牌局列表</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>牌局ID</th>
                                <th>牌局名称</th>
                                <th>游戏类型</th>
                                <th>盲注级别</th>
                                <th>买入</th>
                                <th>玩家</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="gamesTable">
                            <!-- 牌局数据将在这里动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 报表统计 -->
            <div id="reports" class="tab-content">
                <h2>数据统计</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="reportDateRange">日期范围：</label>
                        <select id="reportDateRange">
                            <option value="today">今日</option>
                            <option value="week">本周</option>
                            <option value="month">本月</option>
                            <option value="all">全部</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportType">报表类型：</label>
                        <select id="reportType">
                            <option value="financial">财务统计</option>
                            <option value="player">玩家统计</option>
                            <option value="game">牌局统计</option>
                        </select>
                    </div>
                    <div class="form-group" style="align-self: flex-end;">
                        <button class="btn-primary" onclick="generateReport()">生成报表</button>
                    </div>
                </div>
                
                <div id="reportResults" class="summary">
                    <h3>财务统计</h3>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h3>总充值</h3>
                            <p id="reportTotalRecharge">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>总提现</h3>
                            <p id="reportTotalWithdraw">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>总抽水</h3>
                            <p id="reportTotalRake">0</p>
                        </div>
                        <div class="summary-card">
                            <h3>净收入</h3>
                            <p id="reportNetIncome">0</p>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;">活跃玩家排行</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>排名</th>
                                    <th>玩家ID</th>
                                    <th>昵称</th>
                                    <th>参与牌局</th>
                                    <th>总充值</th>
                                    <th>总盈利</th>
                                </tr>
                            </thead>
                            <tbody id="topPlayersTable">
                                <!-- 玩家排行数据将在这里动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 玩家详情模态框 -->
    <div id="playerModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('playerModal')">&times;</span>
            <h2 id="modalPlayerTitle">玩家详情</h2>
            <div id="modalPlayerContent">
                <!-- 玩家详情内容将在这里动态生成 -->
            </div>
        </div>
    </div>

    <!-- 牌局详情模态框 -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('gameModal')">&times;</span>
            <h2 id="modalGameTitle">牌局详情</h2>
            <div id="modalGameContent">
                <!-- 牌局详情内容将在这里动态生成 -->
            </div>
        </div>
    </div>

    <script>
        // 模拟实时牌局数据
let simulatedGames = [
    {
        id: 'game_' + Date.now(),
        name: 'VIP1号桌',
        type: '德州扑克',
        stakes: '10/20',
        current_player: '玩家A',
        pot: '2,500',
        players: 6,
        status: 'active',
        updatedAt: new Date().toISOString()
    },
    {
        id: 'game_' + (Date.now() + 1),
        name: '高额奥马哈',
        type: '奥马哈',
        stakes: '50/100',
        current_player: '玩家B',
        pot: '12,800',
        players: 8,
        status: 'active',
        updatedAt: new Date().toISOString()
    },
    {
        id: 'game_' + (Date.now() + 2),
        name: '新手桌',
        type: '德州扑克',
        stakes: '5/10',
        current_player: '-',
        pot: '0',
        players: 2,
        status: 'waiting',
        updatedAt: new Date().toISOString()
    }
];

// 更新实时牌局表格
function updateRealTimeGamesTable(games) {
    const tbody = document.getElementById('realTimeGamesTable');
    tbody.innerHTML = '';
    
    if (!games || games.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">暂无实时牌局数据</td></tr>';
        return;
    }
    
    games.forEach(game => {
        const row = document.createElement('tr');
        if (game.status === 'active') {
            row.classList.add('real-time-game-active');
        } else if (game.status === 'waiting') {
            row.classList.add('real-time-game-warning');
        }
        
        row.innerHTML = `
            <td>${game.id.substring(0, 8)}...</td>
            <td>${game.name}</td>
            <td>${game.type}</td>
            <td>${game.stakes}</td>
            <td class="current-player">${game.current_player || '-'}</td>
            <td class="pot-size">${game.pot || '0'}</td>
            <td>${game.players}/${game.maxPlayers || 8}</td>
            <td>${getGameStatusText(game.status)}</td>
        `;
        tbody.appendChild(row);
    });
}

// 获取牌局状态文本
function getGameStatusText(status) {
    switch(status) {
        case 'active': return '<span class="status-active">进行中</span>';
        case 'waiting': return '<span class="status-waiting">等待中</span>';
        case 'ended': return '<span class="status-ended">已结束</span>';
        default: return status;
    }
}

// 模拟数据更新函数
function simulateDataUpdate() {
    // 随机更新一些数据
    simulatedGames.forEach(game => {
        if (game.status === 'active') {
            // 随机更新底池金额
            const potIncrease = Math.floor(Math.random() * 1000);
            game.pot = (parseInt(game.pot.replace(/,/g, '')) + potIncrease).toLocaleString();
            
            // 随机切换当前玩家
            const players = ['玩家A', '玩家B', '玩家C', '玩家D', '玩家E'];
            game.current_player = players[Math.floor(Math.random() * players.length)];
            
            // 小概率结束牌局
            if (Math.random() < 0.05) {
                game.status = 'ended';
            }
        } else if (game.status === 'waiting') {
            // 等待中的牌局有小概率开始
            if (Math.random() < 0.1 && game.players >= 2) {
                game.status = 'active';
                game.pot = '500'; // 初始底池
            }
        } else if (game.status === 'ended') {
            // 已结束的牌局有小概率重新开始
            if (Math.random() < 0.1) {
                game.status = 'waiting';
                game.players = 2;
                game.pot = '0';
                game.current_player = '-';
            }
        }
        
        // 随机增减玩家数量
        if (game.status !== 'ended') {
            const playerChange = Math.random() < 0.5 ? 1 : -1;
            const newPlayerCount = game.players + playerChange;
            if (newPlayerCount >= 2 && newPlayerCount <= (game.maxPlayers || 8)) {
                game.players = newPlayerCount;
            }
        }
        
        game.updatedAt = new Date().toISOString();
    });
    
    // 小概率添加新牌局
    if (Math.random() < 0.1 && simulatedGames.length < 5) {
        const stakesOptions = ['5/10', '10/20', '25/50', '50/100'];
        const types = ['德州扑克', '奥马哈', '短牌'];
        simulatedGames.push({
            id: 'game_' + Date.now(),
            name: '新牌局-' + Math.floor(Math.random() * 100),
            type: types[Math.floor(Math.random() * types.length)],
            stakes: stakesOptions[Math.floor(Math.random() * stakesOptions.length)],
            current_player: '-',
            pot: '0',
            players: 2,
            status: 'waiting',
            updatedAt: new Date().toISOString()
        });
    }
    
    // 小概率移除牌局
    if (Math.random() < 0.05 && simulatedGames.length > 3) {
        const endedGames = simulatedGames.filter(g => g.status === 'ended');
        if (endedGames.length > 0) {
            const index = simulatedGames.indexOf(endedGames[0]);
            simulatedGames.splice(index, 1);
        }
    }
    
    // 更新表格
    updateRealTimeGamesTable(simulatedGames);
}

// 初始化实时数据更新
function initRealTimeUpdates() {
    // 立即更新一次
    updateRealTimeGamesTable(simulatedGames);
    
    // 设置定时刷新模拟数据
    setInterval(simulateDataUpdate, 3000); // 每3秒更新一次
}

// 在DOM加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    // ...其他初始化代码...
    
    // 初始化实时更新
    initRealTimeUpdates();
});
        // 存储玩家和牌局数据的数组
        let players = [];
        let games = [];
        
        // DOM加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 加载本地存储的数据
            loadData();
            
            // 表单提交事件
            document.getElementById('playerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                savePlayer();
            });
            
            document.getElementById('gameForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveGame();
            });
            
            // 初始化仪表盘
            updateDashboard();
        });
        
        // 切换标签页
        function switchTab(tabId) {
            // 隐藏所有标签内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 取消所有标签的活动状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的标签内容
            document.getElementById(tabId).classList.add('active');
            
            // 设置选中标签的活动状态
            event.currentTarget.classList.add('active');
            
            // 如果切换到仪表盘，更新数据
            if (tabId === 'dashboard') {
                updateDashboard();
            }
        }
        
        // 加载数据
        function loadData() {
            const savedPlayers = localStorage.getItem('wpkPlayers');
            const savedGames = localStorage.getItem('wpkGames');
            
            if (savedPlayers) {
                players = JSON.parse(savedPlayers);
                renderPlayersTable();
            }
            
            if (savedGames) {
                games = JSON.parse(savedGames);
                renderGamesTable();
            }
        }
        
        // 保存数据
        function saveData() {
            localStorage.setItem('wpkPlayers', JSON.stringify(players));
            localStorage.setItem('wpkGames', JSON.stringify(games));
        }
        
        // ========== 玩家管理功能 ==========
        // 保存玩家
        function savePlayer() {
            const editIndex = parseInt(document.getElementById('playerEditIndex').value);
            const player = {
                id: document.getElementById('playerId').value,
                nickname: document.getElementById('playerNickname').value,
                recharge: parseFloat(document.getElementById('playerRecharge').value),
                frozen: parseFloat(document.getElementById('playerFrozen').value),
                level: document.getElementById('playerLevel').value,
                status: document.getElementById('playerStatus').value,
                createdAt: editIndex >= 0 ? players[editIndex].createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (editIndex >= 0) {
                // 更新现有玩家
                players[editIndex] = player;
            } else {
                // 添加新玩家
                players.push(player);
            }
            
            // 保存数据
            saveData();
            
            // 重新渲染表格
            renderPlayersTable();
            
            // 更新仪表盘
            updateDashboard();
            
            // 重置表单
            resetPlayerForm();
        }
        
        // 渲染玩家表格
        function renderPlayersTable() {
            const tbody = document.getElementById('playersTable');
            tbody.innerHTML = '';
            
            if (players.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">暂无玩家数据</td></tr>';
                return;
            }
            
            players.forEach((player, index) => {
                const remaining = player.recharge - player.frozen;
                const remainingClass = remaining >= 0 ? 'positive' : 'negative';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${player.id}</td>
                    <td>${player.nickname}</td>
                    <td><span class="chip">${player.level}</span></td>
                    <td>${player.recharge.toFixed(2)}</td>
                    <td>${player.frozen.toFixed(2)}</td>
                    <td class="${remainingClass}">${remaining.toFixed(2)}</td>
                    <td>${getStatusText(player.status)}</td>
                    <td class="actions">
                        <button class="btn-primary btn-sm" onclick="editPlayer(${index})">编辑</button>
                        <button class="btn-warning btn-sm" onclick="viewPlayerDetails(${index})">详情</button>
                        <button class="btn-danger btn-sm" onclick="deletePlayer(${index})">删除</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // 编辑玩家
        function editPlayer(index) {
            const player = players[index];
            document.getElementById('playerEditIndex').value = index;
            document.getElementById('playerId').value = player.id;
            document.getElementById('playerNickname').value = player.nickname;
            document.getElementById('playerRecharge').value = player.recharge;
            document.getElementById('playerFrozen').value = player.frozen;
            document.getElementById('playerLevel').value = player.level;
            document.getElementById('playerStatus').value = player.status;
            
            // 切换到玩家管理标签
            switchTab('players');
        }
        
        // 查看玩家详情
        function viewPlayerDetails(index) {
            const player = players[index];
            const remaining = player.recharge - player.frozen;
            
            document.getElementById('modalPlayerTitle').textContent = `玩家详情 - ${player.nickname}`;
            
            let content = `
                <div class="card">
                    <div class="card-header">
                        <h3>${player.nickname} (ID: ${player.id})</h3>
                    </div>
                    <div class="card-body">
                        <p><strong>玩家等级：</strong> <span class="chip">${player.level}</span></p>
                        <p><strong>玩家状态：</strong> ${getStatusText(player.status)}</p>
                        <p><strong>充值总额：</strong> ${player.recharge.toFixed(2)}</p>
                        <p><strong>冻结积分：</strong> ${player.frozen.toFixed(2)}</p>
                        <p><strong>剩余积分：</strong> <span class="${remaining >= 0 ? 'positive' : 'negative'}">${remaining.toFixed(2)}</span></p>
                        <p><strong>创建时间：</strong> ${formatDate(player.createdAt)}</p>
                        <p><strong>最后更新：</strong> ${formatDate(player.updatedAt)}</p>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">参与牌局记录</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>牌局ID</th>
                                <th>牌局名称</th>
                                <th>游戏类型</th>
                                <th>结果</th>
                                <th>时间</th>
                            </tr>
                        </thead>
                        <tbody id="playerGameHistory">
                            <!-- 玩家参与的牌局记录将在这里动态生成 -->
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('modalPlayerContent').innerHTML = content;
            
            // 显示玩家参与的牌局记录（示例数据，实际应从游戏数据中获取）
            const tbody = document.getElementById('playerGameHistory');
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">暂无牌局记录</td></tr>';
            
            openModal('playerModal');
        }
        
        // 删除玩家
        function deletePlayer(index) {
            if (confirm('确定要删除这个玩家吗？此操作不可撤销！')) {
                players.splice(index, 1);
                saveData();
                renderPlayersTable();
                updateDashboard();
            }
        }
        
        // 重置玩家表单
        function resetPlayerForm() {
            document.getElementById('playerEditIndex').value = '-1';
            document.getElementById('playerForm').reset();
            document.getElementById('playerLevel').value = '普通';
            document.getElementById('playerStatus').value = 'active';
        }
        
        // ========== 牌局管理功能 ==========
        // 保存牌局
        function saveGame() {
            const editGameId = document.getElementById('gameEditId').value;
            const game = {
                id: editGameId || 'game_' + Date.now(),
                name: document.getElementById('gameName').value,
                type: document.getElementById('gameType').value,
                stakes: document.getElementById('gameStakes').value,
                buyIn: parseInt(document.getElementById('gameBuyIn').value),
                maxPlayers: parseInt(document.getElementById('gameMaxPlayers').value),
                timeBank: parseInt(document.getElementById('gameTimeBank').value),
                ante: parseInt(document.getElementById('gameAnte').value) || 0,
                rake: parseFloat(document.getElementById('gameRake').value) || 0,
                password: document.getElementById('gamePassword').value,
                status: document.getElementById('gameStatus').value,
                players: editGameId ? games.find(g => g.id === editGameId)?.players || [] : [],
                createdAt: editGameId ? games.find(g => g.id === editGameId)?.createdAt || new Date().toISOString() : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (editGameId) {
                // 更新现有牌局
                const index = games.findIndex(g => g.id === editGameId);
                if (index !== -1) {
                    games[index] = game;
                }
            } else {
                // 添加新牌局
                games.push(game);
            }
            
            // 保存数据
            saveData();
            
            // 重新渲染表格
            renderGamesTable();
            
            // 更新仪表盘
            updateDashboard();
            
            // 重置表单
            resetGameForm();
        }
        
        // 渲染牌局表格
        function renderGamesTable() {
            const tbody = document.getElementById('gamesTable');
            tbody.innerHTML = '';
            
            if (games.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">暂无牌局数据</td></tr>';
                return;
            }
            
            // 按创建时间倒序排列
            const sortedGames = [...games].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedGames.forEach(game => {
                const playerCount = game.players ? game.players.length : 0;
                const playerDisplay = `${playerCount}/${game.maxPlayers}`;
                const statusClass = game.status === 'active' ? 'status-active' : 
                                  game.status === 'ended' ? 'status-ended' : '';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${game.id.substring(0, 8)}...</td>
                    <td>${game.name}</td>
                    <td>${game.type}</td>
                    <td>${game.stakes}</td>
                    <td>${game.buyIn}</td>
                    <td>${playerDisplay}</td>
                    <td class="${statusClass}">${getGameStatusText(game.status)}</td>
                    <td class="actions">
                        <button class="btn-primary btn-sm" onclick="editGame('${game.id}')">编辑</button>
                        <button class="btn-success btn-sm" onclick="viewGameDetails('${game.id}')">详情</button>
                        <button class="btn-danger btn-sm" onclick="deleteGame('${game.id}')">删除</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // 编辑牌局
        function editGame(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;
            
            document.getElementById('gameEditId').value = game.id;
            document.getElementById('gameName').value = game.name;
            document.getElementById('gameType').value = game.type;
            document.getElementById('gameStakes').value = game.stakes;
            document.getElementById('gameBuyIn').value = game.buyIn;
            document.getElementById('gameMaxPlayers').value = game.maxPlayers;
            document.getElementById('gameTimeBank').value = game.timeBank;
            document.getElementById('gameAnte').value = game.ante;
            document.getElementById('gameRake').value = game.rake;
            document.getElementById('gamePassword').value = game.password || '';
            document.getElementById('gameStatus').value = game.status;
            
            // 切换到牌局管理标签
            switchTab('games');
        }
        
        // 查看牌局详情
        function viewGameDetails(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;
            
            document.getElementById('modalGameTitle').textContent = `牌局详情 - ${game.name}`;
            
            let content = `
                <div class="card">
                    <div class="card-header">
                        <h3>${game.name} (ID: ${game.id})</h3>
                    </div>
                    <div class="card-body">
                        <p><strong>游戏类型：</strong> ${game.type}</p>
                        <p><strong>盲注级别：</strong> ${game.stakes}</p>
                        <p><strong>买入金额：</strong> ${game.buyIn}</p>
                        <p><strong>最大玩家数：</strong> ${game.maxPlayers}</p>
                        <p><strong>思考时间：</strong> ${game.timeBank}秒</p>
                        <p><strong>前注：</strong> ${game.ante}</p>
                        <p><strong>抽水比例：</strong> ${game.rake}%</p>
                        <p><strong>牌局状态：</strong> ${getGameStatusText(game.status)}</p>
                        <p><strong>创建时间：</strong> ${formatDate(game.createdAt)}</p>
                        <p><strong>最后更新：</strong> ${formatDate(game.updatedAt)}</p>
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">玩家列表</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>玩家ID</th>
                                <th>昵称</th>
                                <th>买入</th>
                                <th>当前筹码</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody id="gamePlayersList">
                            <!-- 牌局玩家列表将在这里动态生成 -->
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('modalGameContent').innerHTML = content;
            
            // 显示牌局玩家列表（示例数据，实际应从游戏数据中获取）
            const tbody = document.getElementById('gamePlayersList');
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">暂无玩家数据</td></tr>';
            
            openModal('gameModal');
        }
        
        // 删除牌局
        function deleteGame(gameId) {
            if (confirm('确定要删除这个牌局吗？此操作不可撤销！')) {
                games = games.filter(g => g.id !== gameId);
                saveData();
                renderGamesTable();
                updateDashboard();
            }
        }
        
        // 重置牌局表单
        function resetGameForm() {
            document.getElementById('gameEditId').value = '';
            document.getElementById('gameForm').reset();
            document.getElementById('gameMaxPlayers').value = 6;
            document.getElementById('gameTimeBank').value = 30;
            document.getElementById('gameAnte').value = 0;
            document.getElementById('gameRake').value = 5;
            document.getElementById('gameStatus').value = 'active';
        }
        
        // ========== 仪表盘功能 ==========
        // 更新仪表盘
        function updateDashboard() {
            // 玩家统计
            document.getElementById('totalPlayers').textContent = players.length;
            
            // 牌局统计
            const today = new Date().toISOString().split('T')[0];
            const activeGames = games.filter(g => g.status === 'active').length;
            const todayGames = games.filter(g => g.createdAt.startsWith(today)).length;
            
            // 计算总充值
            const totalRecharge = players.reduce((sum, player) => sum + (player.recharge || 0), 0);
            
            // 计算总抽水（示例逻辑，实际应根据牌局结果计算）
            const totalRake = games.reduce((sum, game) => sum + (game.rake || 0), 0);
            
            document.getElementById('activeGames').textContent = activeGames;
            document.getElementById('todayGames').textContent = todayGames;
            document.getElementById('totalRecharge').textContent = totalRecharge.toFixed(2);
            document.getElementById('totalRake').textContent = totalRake.toFixed(2);
            
            // 更新最近牌局表格
            updateRecentGamesTable();
            
            // 更新活跃玩家卡片
            updateActivePlayersCards();
        }
        
        // 更新最近牌局表格
        function updateRecentGamesTable() {
            const tbody = document.getElementById('recentGamesTable');
            tbody.innerHTML = '';
            
            // 获取最近5个牌局（按创建时间倒序）
            const recentGames = [...games]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);
            
            if (recentGames.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">暂无牌局数据</td></tr>';
                return;
            }
            
            recentGames.forEach(game => {
                const playerCount = game.players ? game.players.length : 0;
                const statusClass = game.status === 'active' ? 'status-active' : 
                                  game.status === 'ended' ? 'status-ended' : '';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${game.name}</td>
                    <td>${game.type}</td>
                    <td>${game.stakes}</td>
                    <td>${playerCount}/${game.maxPlayers}</td>
                    <td class="${statusClass}">${getGameStatusText(game.status)}</td>
                    <td class="actions">
                        <button class="btn-primary btn-sm" onclick="viewGameDetails('${game.id}')">详情</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // 更新活跃玩家卡片
        function updateActivePlayersCards() {
            const container = document.getElementById('activePlayersList');
            container.innerHTML = '';
            
            // 获取活跃玩家（按充值金额倒序，最多6个）
            const activePlayers = [...players]
                .filter(p => p.status === 'active')
                .sort((a, b) => b.recharge - a.recharge)
                .slice(0, 6);
            
            if (activePlayers.length === 0) {
                container.innerHTML = '<p>暂无活跃玩家数据</p>';
                return;
            }
            
            activePlayers.forEach(player => {
                const remaining = player.recharge - player.frozen;
                const remainingClass = remaining >= 0 ? 'positive' : 'negative';
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        <h3>${player.nickname}</h3>
                    </div>
                    <div class="card-body">
                        <p><strong>ID：</strong> ${player.id}</p>
                        <p><strong>等级：</strong> <span class="chip">${player.level}</span></p>
                        <p><strong>剩余积分：</strong> <span class="${remainingClass}">${remaining.toFixed(2)}</span></p>
                    </div>
                    <div class="card-footer">
                        <button class="btn-primary btn-sm" onclick="viewPlayerDetails(${players.indexOf(player)})">详情</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // ========== 报表统计功能 ==========
        // 生成报表
        function generateReport() {
            const dateRange = document.getElementById('reportDateRange').value;
            const reportType = document.getElementById('reportType').value;
            
            // 这里应该根据日期范围和报表类型生成相应的报表数据
            // 以下是示例数据
            
            // 财务统计
            const totalRecharge = players.reduce((sum, player) => sum + (player.recharge || 0), 0);
            const totalRake = games.reduce((sum, game) => sum + (game.rake || 0), 0);
            
            document.getElementById('reportTotalRecharge').textContent = totalRecharge.toFixed(2);
            document.getElementById('reportTotalWithdraw').textContent = '0.00'; // 示例数据
            document.getElementById('reportTotalRake').textContent = totalRake.toFixed(2);
            document.getElementById('reportNetIncome').textContent = (totalRake * 100).toFixed(2); // 示例数据
            
            // 活跃玩家排行
            updateTopPlayersTable();
        }
        
        // 更新玩家排行表格
        function updateTopPlayersTable() {
            const tbody = document.getElementById('topPlayersTable');
            tbody.innerHTML = '';
            
            // 获取活跃玩家排行（按充值金额倒序，最多10个）
            const topPlayers = [...players]
                .filter(p => p.status === 'active')
                .sort((a, b) => b.recharge - a.recharge)
                .slice(0, 10);
            
            if (topPlayers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">暂无玩家数据</td></tr>';
                return;
            }
            
            topPlayers.forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${player.id}</td>
                    <td>${player.nickname}</td>
                    <td>5</td> <!-- 示例数据 -->
                    <td>${player.recharge.toFixed(2)}</td>
                    <td class="${player.recharge > 0 ? 'positive' : 'negative'}">${(player.recharge * 0.1).toFixed(2)}</td> <!-- 示例数据 -->
                `;
                tbody.appendChild(row);
            });
        }
        
        // ========== 通用功能 ==========
        // 打开模态框
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }
        
        // 关闭模态框
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // 获取状态文本
        function getStatusText(status) {
            switch(status) {
                case 'active': return '<span class="status-active">活跃</span>';
                case 'inactive': return '<span class="status-ended">不活跃</span>';
                case 'banned': return '<span style="color: #e74c3c; font-weight: bold;">封禁</span>';
                default: return status;
            }
        }
        
        // 获取牌局状态文本
        function getGameStatusText(status) {
            switch(status) {
                case 'active': return '进行中';
                case 'waiting': return '等待中';
                case 'ended': return '已结束';
                default: return status;
            }
        }
        
        // 格式化日期
        function formatDate(isoString) {
            if (!isoString) return '未知';
            const date = new Date(isoString);
            return date.toLocaleString('zh-CN');
        }
        
        // 初始化示例数据（首次使用时可以取消注释）
        /*
        function initializeSampleData() {
            if (players.length === 0 && games.length === 0 && confirm('是否初始化示例数据？')) {
                // 示例玩家数据
                players = [
                    {
                        id: 'player001',
                        nickname: '张三',
                        recharge: 5000,
                        frozen: 1000,
                        level: 'VIP',
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'player002',
                        nickname: '李四',
                        recharge: 3000,
                        frozen: 500,
                        level: '普通',
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'player003',
                        nickname: '王五',
                        recharge: 10000,
                        frozen: 2000,
                        level: 'VVIP',
                        status: 'active',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];
                
                // 示例牌局数据
                games = [
                    {
                        id: 'game_' + Date.now(),
                        name: 'VIP1号桌',
                        type: '德州扑克',
                        stakes: '10/20',
                        buyIn: 2000,
                        maxPlayers: 6,
                        timeBank: 30,
                        ante: 0,
                        rake: 5,
                        password: '',
                        status: 'active',
                        players: ['player001', 'player002'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'game_' + (Date.now() + 1),
                        name: '高额奥马哈',
                        type: '奥马哈',
                        stakes: '50/100',
                        buyIn: 10000,
                        maxPlayers: 8,
                        timeBank: 45,
                        ante: 10,
                        rake: 5,
                        password: 'highstakes',
                        status: 'active',
                        players: ['player003'],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];
                
                // 保存数据
                saveData();
                
                // 重新渲染
                renderPlayersTable();
                renderGamesTable();
                updateDashboard();
            }
        }
        
        // 页面加载后可以调用初始化示例数据
        initializeSampleData();
        */
    </script>
</body>
</html>
<!-- 只展示修改的部分，完整代码请保留之前的所有内容 -->

<!-- 在gameModal的modalGameContent中添加玩家管理部分 -->
<div id="gameModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal('gameModal')">&times;</span>
        <h2 id="modalGameTitle">牌局详情</h2>
        <div id="modalGameContent">
            <!-- 原有牌局详情内容保持不变 -->
            
            <h3 style="margin-top: 20px;">玩家管理</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="addPlayerSelect">添加玩家：</label>
                    <select id="addPlayerSelect">
                        <option value="">选择玩家</option>
                        <!-- 玩家选项将通过JS动态生成 -->
                    </select>
                </div>
                <div class="form-group" style="align-self: flex-end;">
                    <button class="btn-success" onclick="addPlayerToGame()">添加到牌局</button>
                </div>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>玩家ID</th>
                            <th>昵称</th>
                            <th>等级</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="gamePlayersList">
                        <!-- 牌局玩家列表将在这里动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // 添加新函数：更新牌局玩家列表
    function updateGamePlayersList(gameId) {
        const game = games.find(g => g.id === gameId);
        if (!game) return;
        
        const tbody = document.getElementById('gamePlayersList');
        tbody.innerHTML = '';
        
        // 确保players数组存在
        game.players = game.players || [];
        
        if (game.players.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">暂无玩家</td></tr>';
            return;
        }
        
        game.players.forEach(playerId => {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${player.id}</td>
                <td>${player.nickname}</td>
                <td><span class="chip">${player.level}</span></td>
                <td>${getStatusText(player.status)}</td>
                <td class="actions">
                    <button class="btn-danger btn-sm" onclick="removePlayerFromGame('${gameId}', '${playerId}')">移除</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }
    
    // 添加新函数：更新添加玩家下拉框
    function updateAddPlayerSelect(gameId) {
        const game = games.find(g => g.id === gameId);
        if (!game) return;
        
        const select = document.getElementById('addPlayerSelect');
        select.innerHTML = '<option value="">选择玩家</option>';
        
        // 获取尚未加入该牌局的活跃玩家
        const availablePlayers = players.filter(player => 
            player.status === 'active' && 
            !game.players.includes(player.id)
        );
        
        availablePlayers.forEach(player => {
            const option = document.createElement('option');
            option.value = player.id;
            option.textContent = `${player.nickname} (${player.id})`;
            select.appendChild(option);
        });
    }
    
    // 添加新函数：添加玩家到牌局
    function addPlayerToGame() {
        const select = document.getElementById('addPlayerSelect');
        const playerId = select.value;
        if (!playerId) return;
        
        const gameId = document.getElementById('gameEditId').value || 
                      document.querySelector('#modalGameTitle').textContent.match(/ID: (game_\w+)/)?.[1];
        
        if (!gameId) return;
        
        const game = games.find(g => g.id === gameId);
        if (!game) return;
        
        // 确保players数组存在
        game.players = game.players || [];
        
        // 检查玩家是否已在牌局中
        if (!game.players.includes(playerId)) {
            game.players.push(playerId);
            game.updatedAt = new Date().toISOString();
            
            // 保存数据
            saveData();
            
            // 更新UI
            updateGamePlayersList(gameId);
            updateAddPlayerSelect(gameId);
            renderGamesTable();
            updateDashboard();
            
            alert('玩家已成功添加到牌局');
        }
    }
    
    // 添加新函数：从牌局移除玩家
    function removePlayerFromGame(gameId, playerId) {
        if (!confirm(`确定要将玩家 ${playerId} 从牌局中移除吗？`)) return;
        
        const game = games.find(g => g.id === gameId);
        if (!game) return;
        
        game.players = game.players.filter(id => id !== playerId);
        game.updatedAt = new Date().toISOString();
        
        // 保存数据
        saveData();
        
        // 更新UI
        updateGamePlayersList(gameId);
        updateAddPlayerSelect(gameId);
        renderGamesTable();
        updateDashboard();
        
        alert('玩家已从牌局中移除');
    }
    
    // 修改viewGameDetails函数，添加玩家管理功能
    function viewGameDetails(gameId) {
        const game = games.find(g => g.id === gameId);
        if (!game) return;
        
        document.getElementById('modalGameTitle').textContent = `牌局详情 - ${game.name} (ID: ${game.id})`;
        
        let content = `
            <div class="card">
                <div class="card-header">
                    <h3>${game.name}</h3>
                </div>
                <div class="card-body">
                    <p><strong>游戏类型：</strong> ${game.type}</p>
                    <p><strong>盲注级别：</strong> ${game.stakes}</p>
                    <p><strong>买入金额：</strong> ${game.buyIn}</p>
                    <p><strong>玩家数量：</strong> ${game.players?.length || 0}/${game.maxPlayers}</p>
                    <p><strong>思考时间：</strong> ${game.timeBank}秒</p>
                    <p><strong>前注：</strong> ${game.ante}</p>
                    <p><strong>抽水比例：</strong> ${game.rake}%</p>
                    <p><strong>牌局状态：</strong> ${getGameStatusText(game.status)}</p>
                    <p><strong>创建时间：</strong> ${formatDate(game.createdAt)}</p>
                    <p><strong>最后更新：</strong> ${formatDate(game.updatedAt)}</p>
                </div>
            </div>
            
            <h3 style="margin-top: 20px;">玩家管理</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="addPlayerSelect">添加玩家：</label>
                    <select id="addPlayerSelect">
                        <option value="">选择玩家</option>
                        <!-- 玩家选项将通过JS动态生成 -->
                    </select>
                </div>
                <div class="form-group" style="align-self: flex-end;">
                    <button class="btn-success" onclick="addPlayerToGame()">添加到牌局</button>
                </div>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>玩家ID</th>
                            <th>昵称</th>
                            <th>等级</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="gamePlayersList">
                        <!-- 牌局玩家列表将在这里动态生成 -->
                    </tbody>
                </table>
            </div>
        `;
        
        document.getElementById('modalGameContent').innerHTML = content;
        
        // 初始化玩家下拉框和列表
        updateAddPlayerSelect(gameId);
        updateGamePlayersList(gameId);
        
        openModal('gameModal');
    }
</script>
<!-- 在之前代码的基础上，添加以下内容 -->

<style>
    /* 添加计时器相关样式 */
    .timer-display {
        font-size: 24px;
        font-weight: bold;
        color: #e74c3c;
        text-align: center;
        margin: 10px 0;
        padding: 10px;
        background-color: #f9f9f9;
        border-radius: 5px;
        border: 1px solid #ddd;
    }
    
    .player-timer {
        display: inline-block;
        padding: 3px 8px;
        background-color: #34495e;
        color: white;
        border-radius: 3px;
        font-size: 12px;
        margin-left: 5px;
    }
    
    .timer-controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 15px 0;
    }
    
    .timer-low {
        color: #e74c3c;
        animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
</style>

<!-- 在gameModal的modalGameContent中添加计时器控制部分 -->
<div id="gameModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal('gameModal')">&times;</span>
        <h2 id="modalGameTitle">牌局详情</h2>
        <div id="modalGameContent">
            <!-- 原有牌局详情内容保持不变 -->
            
            <!-- 添加计时器部分 -->
            <div class="card">
                <div class="card-header">
                    <h3>牌局计时器</h3>
                </div>
                <div class="card-body">
                    <div class="timer-display" id="gameDuration">
                        牌局已进行: 00:00:00
                    </div>
                    <div class="timer-controls">
                        <button class="btn-primary" onclick="startGameTimer()">开始计时</button>
                        <button class="btn-warning" onclick="pauseGameTimer()">暂停</button>
                        <button class="btn-danger" onclick="resetGameTimer()">重置</button>
                    </div>
                    
                    <h4>当前行动玩家</h4>
                    <div id="currentPlayerDisplay" style="margin-bottom: 10px;">
                        等待牌局开始...
                    </div>
                    <div class="timer-display" id="playerTimer">
                        剩余时间: 00:00
                    </div>
                    <div class="timer-controls">
                        <button class="btn-success" onclick="nextPlayer()">下一位玩家</button>
                        <button class="btn-warning" onclick="addTimeToPlayer(10)">+10秒</button>
                        <button class="btn-warning" onclick="addTimeToPlayer(30)">+30秒</button>
                    </div>
                </div>
            </div>
            
            <!-- 原有玩家管理内容保持不变 -->
        </div>
    </div>
</div>

<script>
    // 添加计时器相关变量
    let gameTimerInterval;
    let playerTimerInterval;
    let gameStartTime;
    let gameDuration = 0;
    let currentPlayerIndex = -1;
    let currentPlayerTimeLeft;
    let gameTimeBank; // 牌局设置的思考时间
    
    // 修改viewGameDetails函数，初始化计时器
    function viewGameDetails(gameId) {
        const game = games.find(g => g.id === gameId);
        if (!game) return;
        
        // 保存牌局设置的思考时间
        gameTimeBank = game.timeBank;
        
        document.getElementById('modalGameTitle').textContent = `牌局详情 - ${game.name} (ID: ${game.id})`;
        
        let content = `
            <div class="card">
                <div class="card-header">
                    <h3>${game.name}</h3>
                </div>
                <div class="card-body">
                    <p><strong>游戏类型：</strong> ${game.type}</p>
                    <p><strong>盲注级别：</strong> ${game.stakes}</p>
                    <p><strong>买入金额：</strong> ${game.buyIn}</p>
                    <p><strong>玩家数量：</strong> ${game.players?.length || 0}/${game.maxPlayers}</p>
                    <p><strong>思考时间：</strong> ${game.timeBank}秒</p>
                    <p><strong>前注：</strong> ${game.ante}</p>
                    <p><strong>抽水比例：</strong> ${game.rake}%</p>
                    <p><strong>牌局状态：</strong> ${getGameStatusText(game.status)}</p>
                    <p><strong>创建时间：</strong> ${formatDate(game.createdAt)}</p>
                    <p><strong>最后更新：</strong> ${formatDate(game.updatedAt)}</p>
                </div>
            </div>
            
            <!-- 计时器部分 -->
            <div class="card">
                <div class="card-header">
                    <h3>牌局计时器</h3>
                </div>
                <div class="card-body">
                    <div class="timer-display" id="gameDuration">
                        牌局已进行: 00:00:00
                    </div>
                    <div class="timer-controls">
                        <button class="btn-primary" onclick="startGameTimer()">开始计时</button>
                        <button class="btn-warning" onclick="pauseGameTimer()">暂停</button>
                        <button class="btn-danger" onclick="resetGameTimer()">重置</button>
                    </div>
                    
                    <h4>当前行动玩家</h4>
                    <div id="currentPlayerDisplay" style="margin-bottom: 10px;">
                        等待牌局开始...
                    </div>
                    <div class="timer-display" id="playerTimer">
                        剩余时间: ${formatTime(gameTimeBank)}
                    </div>
                    <div class="timer-controls">
                        <button class="btn-success" onclick="nextPlayer()">下一位玩家</button>
                        <button class="btn-warning" onclick="addTimeToPlayer(10)">+10秒</button>
                        <button class="btn-warning" onclick="addTimeToPlayer(30)">+30秒</button>
                    </div>
                </div>
            </div>
            
            <!-- 玩家管理部分 -->
            <h3 style="margin-top: 20px;">玩家管理</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="addPlayerSelect">添加玩家：</label>
                    <select id="addPlayerSelect">
                        <option value="">选择玩家</option>
                    </select>
                </div>
                <div class="form-group" style="align-self: flex-end;">
                    <button class="btn-success" onclick="addPlayerToGame()">添加到牌局</button>
                </div>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>玩家ID</th>
                            <th>昵称</th>
                            <th>等级</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="gamePlayersList">
                    </tbody>
                </table>
            </div>
        `;
        
        document.getElementById('modalGameContent').innerHTML = content;
        
        // 初始化玩家下拉框和列表
        updateAddPlayerSelect(gameId);
        updateGamePlayersList(gameId);
        
        // 初始化计时器
        resetGameTimer();
        
        openModal('gameModal');
    }
    
    // 格式化时间为HH:MM:SS
    function formatTime(seconds) {
        const hrs = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        
        return [
            hrs.toString().padStart(2, '0'),
            mins.toString().padStart(2, '0'),
            secs.toString().padStart(2, '0')
        ].join(':');
    }
    
    // 开始牌局计时
    function startGameTimer() {
        const gameId = getCurrentGameId();
        if (!gameId) return;
        
        const game = games.find(g => g.id === gameId);
        if (!game) return;
        
        // 如果牌局状态不是进行中，更新状态
        if (game.status !== 'active') {
            game.status = 'active';
            game.updatedAt = new Date().toISOString();
            saveData();
            renderGamesTable();
        }
        
        // 开始牌局总计时
        if (!gameTimerInterval) {
            gameStartTime = new Date();
            gameTimerInterval = setInterval(updateGameDuration, 1000);
        }
        
        // 如果还没有当前玩家，开始第一个玩家
        if (currentPlayerIndex === -1 && game.players.length > 0) {
            nextPlayer();
        }
    }
    
    // 更新牌局持续时间显示
    function updateGameDuration() {
        const now = new Date();
        const elapsed = Math.floor((now - gameStartTime) / 1000) + gameDuration;
        
        document.getElementById('gameDuration').textContent = 
            `牌局已进行: ${formatTime(elapsed)}`;
    }
    
    // 暂停计时器
    function pauseGameTimer() {
        if (gameTimerInterval) {
            clearInterval(gameTimerInterval);
            gameTimerInterval = null;
            
            // 计算已持续时间
            const now = new Date();
            gameDuration += Math.floor((now - gameStartTime) / 1000);
        }
        
        if (playerTimerInterval) {
            clearInterval(playerTimerInterval);
            playerTimerInterval = null;
        }
    }
    
    // 重置计时器
    function resetGameTimer() {
        pauseGameTimer();
        gameDuration = 0;
        currentPlayerIndex = -1;
        
        document.getElementById('gameDuration').textContent = '牌局已进行: 00:00:00';
        document.getElementById('playerTimer').textContent = `剩余时间: ${formatTime(gameTimeBank)}`;
        document.getElementById('currentPlayerDisplay').textContent = '等待牌局开始...';
    }
    
    // 切换到下一位玩家
    function nextPlayer() {
        const gameId = getCurrentGameId();
        if (!gameId) return;
        
        const game = games.find(g => g.id === gameId);
        if (!game || !game.players || game.players.length === 0) return;
        
        // 停止当前玩家计时
        if (playerTimerInterval) {
            clearInterval(playerTimerInterval);
            playerTimerInterval = null;
        }
        
        // 移动到下一位玩家
        currentPlayerIndex = (currentPlayerIndex + 1) % game.players.length;
        currentPlayerTimeLeft = gameTimeBank;
        
        // 更新显示
        const playerId = game.players[currentPlayerIndex];
        const player = players.find(p => p.id === playerId);
        
        if (player) {
            document.getElementById('currentPlayerDisplay').innerHTML = `
                当前行动: <strong>${player.nickname}</strong> 
                <span class="player-timer">${player.level}</span>
            `;
        }
        
        document.getElementById('playerTimer').textContent = `剩余时间: ${formatTime(currentPlayerTimeLeft)}`;
        document.getElementById('playerTimer').className = 'timer-display';
        
        // 开始新玩家计时
        playerTimerInterval = setInterval(updatePlayerTimer, 1000);
    }
    
    // 更新玩家计时器
    function updatePlayerTimer() {
        currentPlayerTimeLeft--;
        
        document.getElementById('playerTimer').textContent = `剩余时间: ${formatTime(currentPlayerTimeLeft)}`;
        
        // 时间不足10秒时显示警告
        if (currentPlayerTimeLeft <= 10) {
            document.getElementById('playerTimer').className = 'timer-display timer-low';
        }
        
        // 时间用完自动切换到下一位玩家
        if (currentPlayerTimeLeft <= 0) {
            nextPlayer();
        }
    }
    
    // 为当前玩家增加时间
    function addTimeToPlayer(seconds) {
        if (currentPlayerIndex === -1) return;
        
        currentPlayerTimeLeft += seconds;
        document.getElementById('playerTimer').textContent = `剩余时间: ${formatTime(currentPlayerTimeLeft)}`;
        
        // 如果添加时间后超过10秒，移除警告样式
        if (currentPlayerTimeLeft > 10) {
            document.getElementById('playerTimer').className = 'timer-display';
        }
    }
    
    // 获取当前牌局ID
    function getCurrentGameId() {
        const title = document.getElementById('modalGameTitle').textContent;
        const match = title.match(/ID: (game_\w+)/);
        return match ? match[1] : null;
    }
</script>
